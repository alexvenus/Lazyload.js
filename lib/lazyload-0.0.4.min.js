/*! Lazyload.js - v0.0.4 - 2013-01-27
* http://clickalicious.github.com/Lazyload.js/
* Copyright (c) 2013 Benjamin Carl; Licensed MIT, New BSD */
(function(g,k){g.Lazyload={instance:null,ready:!1,isDomReady:!1,onDomReady:[],Core:{Init:function(){if(!Lazyload.isDomReady){var b=[{o:k,m:[["addEventListener","DOMContentLoaded"]]},{o:g,m:[["addEventListener","load"]]},{o:g,m:[["attachEvent","onload"]]}];a:{var c,a,d=function(){var a,b=Lazyload.onDomReady.length;Lazyload.isDomReady=!0;for(a=0;a<b;++a)Lazyload.onDomReady[a].callback()};for(c=0;c<b.length;++c)for(a=0;a<b[c].m.length;++a)if(b[c].o[b[c].m[a][0]]){b[c].o[b[c].m[a][0]](b[c].m[a][1],d,
!1);break a}}Lazyload.ready=!0}},Loader:function(b){var c=0,a={},d={dependencyIdentifier:["import","resources","configuration","property"],hash:{algorithm:"Simple"},extension:null,translate:"/",parse:!1,caching:!0,timeout:0,pipesMax:0,debug:{enabled:!1,logger:function(){}}},G=new Lazyload.Hash[d.hash.algorithm],H=new Lazyload.Parse.Annotation,l={},r=0,s={},m=0,z=k.getElementsByTagName("head")[0],I=k.getElementsByTagName("body")[0],n={api:[],internal:[]},p={api:[],internal:[]},t=[],q=[],A,K=function(a){a=
H.parse(a,d.dependencyIdentifier);var b=[],h={},c={},j;if(a.length)for(j=0;j<a.length;++j)switch(a[j][0]){case "resources":b=a[j][1];break;case "configuration":h=eval(a[j][1]);break;case "properties":c=eval(a[j][1])}return{resources:b.toString(),configuration:h,properties:c}},B=function(){if(Lazyload.isDomReady)for(var u=c+1,b;u--;)for(var h in a[u]){b=s[h];if(!0!==q[b.uri]){var e=b,d=k.createElement(e.type),f="\n"+e.source+"\n";e.contentType="text/"+("script"===e.type?"javascript":"css");d.type=
e.contentType;d.id=e.domId;"script"===e.type?(d.defer=!0,d.text=f):d.styleSheet?d.styleSheet.cssText=f:d.appendChild(k.createTextNode(f));"head"===e.target?z.appendChild(d):I.appendChild(d)}b.callback&&(0,b.callback)();!0!==b.caching&&delete s[b.uid]}else setTimeout(function(){B()},10)},v=function(u){c=m=0;a={};!0===u&&(q=[],t=[],n={api:[],internal:[]},p={api:[],internal:[]})},C=function(a){!0===a?(A=g.onerror,g.onerror=function(){return!0}):g.onerror=A},D=function(a){return"http://"===a.substring(0,
7)||"https://"===a.substring(0,8)||"//"===a.substring(0,2)},F=function(a){void 0!==d.loader&&void 0!==g.localStorage&&!D(a.uri)?(d.loader.lazyObject=a,C(!0),d.loader.require({url:a.uri,key:a.uid}).then(function(){C(!1);var a=d.loader.lazyObject;a.source=d.loader.get(a.uid).data;a.source?x(a,!0):(E(a.uri),v(!0))})):0===d.pipesMax||r<d.pipesMax?(r++,(D(a.uri)?new Lazyload.Pipe.Dom:new Lazyload.Pipe.Xhr).create({timeout:d.timeout,url:a.uri,preventBrowserCaching:!a.caching,callback:function(b,c){r--;
c?!0===b?a.source=c:(E(a.uri),v(!0)):a.parsed=!0;x(a,!0)},type:a.type,source:k,target:z}).open()):setTimeout(function(){F(a)},100);return!0},x=function(b,J){m--;!0===J&&(s[b.uid]=b);var h;"style"!==b.type&&(!0===d.parse&&!1===b.parsed)&&(h=K(b.source),0<h.resources.length?h.properties.parent=b.uid:h=!1);b.parsed=!0;h&&(y(h.resources,h.properties,h.configuration),w());h=b.uid;var e=b.parent;null===e?a[c]?void 0===a[c][h]&&(a[c][h]={}):(a[c]={},a[c][h]={}):(void 0!==a[c][e]&&(c++,a[c]={}),a[c][h]={});
0===m&&(B(),v(),w())},w=function(){if(0<t.length){var a=t.pop(),b,c=a.resources.split(","),e;for(e=0;e<c.length;++e){c[e]=c[e].trim();b=c[e];var j=a.properties,f=void 0,g=void 0,k=void 0,g=void 0!==j&&j.uid?j.uid:G.calculate(b);l[g]?f=l[g]:(f={domId:b,args:null,callback:null,caching:d.caching,uid:g,parent:null,lazyClass:"",path:"",file:"",uri:"",wait:!1,type:"script",target:"head",parsed:!1,lazyPackage:{asString:!1,asArray:b.split(d.translate)}},f.lazyClass=f.lazyPackage.asArray.pop(),f.lazyPackage.asString=
f.lazyPackage.asArray.join(d.translate),f.path=f.lazyPackage.asArray.join("/")+"/",f.file=f.lazyClass+(d.extension?d.extension:""),f.uri=f.path+f.file,l[g]=f);for(k in j)f[k]=j[k];b=f;"css"===c[e].split(".").pop()&&(b.type="style");m++;!b.caching||b.caching&&!s[b.uid]&&!q[c[e]]?(q.push(c[e]),F(b)):x(b,!1)}}else{a=[];for(e=0;e<n.api.length;++e)c=n.api[e],n.api.splice(e,1),a.push(c);c=q.toString().split(",");v(!0);for(e=0;e<a.length;++e)a[e](c)}},E=function(a,b){for(var c=!b?"api":b,d,j=0;j<p[c].length;++j)d=
p[c][j],p[c].splice(j,1),d(a)};this.config=function(a){a=a?a:void 0;if(void 0!==a)for(var b in a)d[b]=a[b];return d};this.require=function(a,b,c){y(a,b,c);w();return this};this.and=function(b,c,d){y(b,c,d);a:{for(var e in a){b=!1;break a}b=!0}!0===(!0===b&&0===r&&0===m)&&w();return this};this.then=function(a,b){"function"===typeof a&&n.api.push(a);"function"===typeof b&&p.api.push(b);return this};var y=function(a,b,c){t.unshift({resources:a,properties:b,configuration:c})};void 0!==b&&this.config(b);
return this}},Hash:{Djb2:function(){this.calculate=function(b){var c,a=5381;for(c=0;c<b.length;++c)a=(a<<5)+a+b[c];return a};return this},Simple:function(){this.calculate=function(b){for(var c=0,a=1;a<b.length;++a)c+=b.charCodeAt(a-1)*a|b.charCodeAt(a)*(a+1);return c};return this}},Parse:{Annotation:function(){this.parse=function(b,c){var a,d=[],g=b.match(/(@)[\w\d]+[\s]+[\w\d\/.:,]+/g);if(g&&g.length){var k;for(k=0;k<g.length;++k){a=g[k].split(" ");a[0]=a[0].replace("@","");var l;if(!(l=!c))a:{for(l=
0;l<c.length;l++)if(c[l]===a[0]){l=!0;break a}l=!1}l&&(a[1]=-1!==a[1].indexOf(",")?a[1].split(","):[a[1]],d.push(a))}}return d};return this}},Pipe:{Xhr:function(){var b;this.create=function(a){!0!==a.preventBrowserCaching&&(a.preventBrowserCaching=!1);a.method||(a.method="get");a.callback||(a.callback=function(){});a.preventBrowserCaching&&(a.url+="?_ac="+(new Date).getTime());b=c();var d=a.callback;0<a.timeout&&(b.timer=setTimeout(function(){b.abort();d(!1)},a.timeout));b.onreadystatechange=function(){4===
b.readyState&&(clearTimeout(b.timer),d(200===b.status?!0:!1,b.responseText))};b.open(a.method,a.url,!0);return this};this.open=function(){b.send(null);return this};var c=function(){try{return new XMLHttpRequest}catch(a){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(b){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(c){}return null};return this},Dom:function(){var b,c=[];this.create=function(a){b=a;a=b.source.createElement("script");a.setAttribute("type","text/javascript");b.callback&&
(a.onreadystatechange=function(){"complete"===this.readyState&&b.callback(!0)},a.onload=b.callback,a.onerror=function(a){c.push(a)});b.id&&a.setAttribute("id",b.id);a.setAttribute("src",b.url);b.element=a;return this};this.open=function(){b.target.appendChild(b.element);return this};return this}},require:function(b,c,a){this.instance||(this.instance=new this.Core.Loader);this.instance.require(b,c,a);return this.instance},config:function(b){this.instance.config(b?b:void 0);return this.instance}};"function"!==
typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});Lazyload.Core.Init()})(this,document);
