/*
   MIT License http://en.wikipedia.org/wiki/MIT_License
            New BSD license http://www.opensource.org/licenses/BSD-3-Clause

 @usage

    Lazyload.require(
        'my/script/jquery-1.8.3.js'
    ).and(
        'my/script/jquery-ui.js'
    ).and(
        'my/script/foo.js'
    ).then(
        function success() {
            alert('ready');
        },
        function failure(failure) {
            alert(failure);
        }
    );

*/
(function(k,j){k.Lazyload={selector:null,dom:[],instance:null,ready:!1,isDomReady:!1,onDomReady:[],Init:function(){if(!Lazyload.isDomReady){var c=[{o:j,m:[["addEventListener","DOMContentLoaded"]]},{o:k,m:[["addEventListener","load"]]},{o:k,m:[["attachEvent","onload"]]}];a:{var b,a,e=function(){var a,b=Lazyload.onDomReady.length;Lazyload.isDomReady=!0;for(a=0;a<b;++a)Lazyload.onDomReady[a].callback()};for(b=0;b<c.length;++b)for(a=0;a<c[b].m.length;++a)if(c[b].o[c[b].m[a][0]]){c[b].o[c[b].m[a][0]](c[b].m[a][1],
e,!1);break a}}this.ready=!0}},Selector:{},Tool:{Loader:function(c){var b,a=0,e={},d=[];k.console||(k.console={log:function(a){var b=j.getElementsByTagName("body")[0];if(b){var g=j.getElementById("debug");if(!g){g=j.createElement("div");g.id="debug";b.appendChild(g);for(b=0;b<d.length;++b)console.log(d[b])}b="";if("object"===typeof a||"array"===typeof a)for(key in a)b+=key+": "+a[key]+"<br />";else b=a;g.innerHTML=g.innerHTML+"<br />"+b}else d[d.length]=a}});var f={dependencyIdentifier:["import",
"files","configuration","property"],extension:null,translate:"/",parse:!0,caching:!0,timeout:0,pipesMax:0,debug:{enabled:!1,logger:function(a){console.log(a)}}},H=new Lazyload.Tool.Hash.Simple,x,q={},n=0,l={},r=0,I=j.getElementsByTagName("head")[0],J=j.getElementsByTagName("body")[0],s={api:[],internal:[]},t={api:[],internal:[]},u=[],B=[],C,K=function(a){x||(x=new Lazyload.Tool.Parser.Annotation);a=x.parse(a,f.dependencyIdentifier);var b=[],g={},m={},p;if(a.length)for(p=0;p<a.length;++p)switch(a[p][0]){case "files":b=
a[p][1];break;case "configuration":g=eval(a[p][1]);break;case "properties":m=eval(a[p][1])}return{files:b.toString(),configuration:g,properties:m}},L=function G(){if(Lazyload.isDomReady)for(var g=a+1;g--;){var m,b;for(b in e[g]){var h=m=l[b],c=j.createElement(h.type),f="\n"+h.source+"\n";h.contentType="text/"+("script"==h.type?"javascript":"css");c.type=h.contentType;c.id=h.domId;"script"==h.type?(c.defer=!0,c.text=f):c.styleSheet?c.styleSheet.cssText=f:c.appendChild(j.createTextNode(f));"head"==
h.target?I.appendChild(c):J.appendChild(c);void 0!=m.callback&&m.callback();m.caching||delete l[m.uid]}}else setTimeout(function(){G()},10)},v=function(b){a=r=0;e={};!0===b&&(u=[],s={api:[],internal:[]},t={api:[],internal:[]})},z=function(b){var g=!1;r--;b.parent?(void 0!=e[a][b.parent]&&(a++,e[a]={}),e[a][b.uid]={}):(e[a]||(e[a]={}),void 0==e[a][b.uid]&&(e[a][b.uid]={}));!0===f.parse&&(!1===b.parsed&&"style"!=b.type)&&(g=K(b.source),0<g.files.length?g.properties.parent=b.uid:g=!1,b.parsed=!0);!1!==
g&&(y(g.files,g.properties,g.configuration),w())},D=function(a){!0===a?(C=k.onerror,k.onerror=function(){return!0}):k.onerror=C},M=function g(a){if(void 0!==f.loader&&void 0!==k.localStorage)f.loader.lazyObject=a,f.loader.remove(a.uid),D(!0),f.loader.require({url:a.uri,key:a.uid}).then(function(){D(!1);var a=f.loader.lazyObject;a.source=f.loader.get(a.uid).data;a.source?(l[a.uid]=a,z(a),A(a)):(E(a),b('Error loading resource: "'+a.uri+'"'),v(!0))});else if(0==f.pipesMax||n<f.pipesMax){var c=new Lazyload.Tool.Pipe.Xhr;
n++;c.create({timeout:f.timeout,url:a.uri,preventBrowserCaching:!a.caching,callback:function(g,c){n--;!0===c?(a.source=g.responseText,l[a.uid]=a,z(a),A(a)):(E(a),b('Error loading resource: "'+a.uri+'"'),v(!0))}});c.open()}else setTimeout(function(){g(a)},10)},A=function(){0===r&&(L(),v(),w())},w=function(){if(0<u.length){var a=u.pop(),b,c=a.files.split(","),h;for(h=0;h<c.length;++h){c[h]=c[h].trim();b=c[h];var e=a.properties,d=void 0,j=void 0,k=void 0,j=void 0!=e&&e.uid?e.uid:H.calculate(b);q[j]?
d=q[j]:(d={domId:b,args:null,callback:void 0,caching:f.caching,uid:j,parent:null,lazyClass:"",path:"",file:"",uri:"",wait:!1,type:"script",target:"head",parsed:!1,lazyPackage:{asString:!1,asArray:b.split(f.translate)}},d.lazyClass=d.lazyPackage.asArray.pop(),d.lazyPackage.asString=d.lazyPackage.asArray.join(f.translate),d.path=d.lazyPackage.asArray.join("/")+"/",d.file=d.lazyClass+(f.extension?f.extension:""),d.uri=d.path+d.file,q[j]=d);for(k in e)d[k]=e[k];b=d;"css"===c[h].split(".").pop()&&(b.type=
"style");r++;!b.caching||b.caching&&!l[b.uid]&&!B[c[h]]?(B[c[h]]=!0,M(b)):(z(b),A(b))}}else{c=void 0;c=!c?"api":c;a=[];for(b=0;b<s[c].length;++b)h=s[c][b],s[c].splice(b,1),a.push(h);v(!0);for(c=0;c<a.length;++c)a[c]()}},E=function(a){for(var b,c=!c?"api":c,d=0;d<t[c].length;++d)b=t[c][d],t[c].splice(d,1),b(a)};this.initialize=function(){b=f.debug.enabled?function(a){f.debug.logger(a);return a}:function(a){return a};return this};this.configure=function(a){if(void 0!=a)for(var b in a)f[b]=a[b];return f};
this.require=function(a,b,c){y(a,b,c);w();return this};this.and=function(a,b,c){y(a,b,c);a:{for(var d in e){a=!1;break a}a=!0}!0===(!0===a&&0===n&&0===r)&&w();return this};this.then=function(a,b){"function"==typeof a&&s.api.push(a);"function"==typeof b&&t.api.push(b);return this};var y=function(a,b,c){u.unshift({files:a,properties:b,configuration:c})};Array.prototype.indexOf=function(a,b,c,d){b=this;c=b.length;for(d=-1;~c;d=b[--c]===a?c:d);return d};var F=function(a){return-1!=this.indexOf(a)};"undefined"===
typeof Array.prototype.contains?Array.prototype.contains=F:null;"undefined"===typeof String.prototype.contains?String.prototype.contains=F:null;"undefined"===typeof String.prototype.trim?String.prototype.trim=function(){return this.replace(/\s+$/,"").replace(/^\s+/,"")}:null;arguments.length&&this.configure(arguments[0]);this.initialize()},Hash:{Djb2:function(){this.calculate=function(c){var b,a=5381;for(b=0;b<c.length;++b)a=(a<<5)+a+c[b];return a}},Simple:function(){this.calculate=function(c){var b=
1,a=0;for(b;b<c.length;++b)a+=c.charCodeAt(b-1)*b|c.charCodeAt(b)*(b+1);return a}}},Intercept:function(){this.selector=[];var c=[];this.hook=function(b,a,c){void 0===a&&(a="");this.selector=b;this.target=c?c:j;this.callback=function(){var b,c,e;b=this.selector;(e=this.target)||(e=j);Lazyload.selector||(Lazyload.selector=new Lazyload.Selector.Qwery);e=Lazyload.selector(b,e);new Lazyload.Tool.Hash.Simple;for(b=0;b<e.length;++b)if(c=e[b].getAttribute("require")){c=Lazyload.dom;var k=e[b].id,q=j.getElementById(e[b].id),
n={},l=void 0;for(l in q)n[l]=q[l];c[k]=n;e[b]["on"+a]=function(){this.href="javascript:void(0);";var a=Lazyload.dom[this.id],b=this.getAttribute("require"),c=this;this.proxy=function(){Lazyload.require(b).then(function(){for(var b in a)"on"==b.substr(0,2)&&(c[b]=a[b])})};for(var d in this)"on"==d.substr(0,2)&&(this[d]=this.proxy);return!1}}};Lazyload.onDomReady.push(this)};this.proxy=function(b){var a=b.target.id;c[a]||(c[a]=[]);c[a].push(b)}},Parser:{Annotation:function(){this.parse=function(c,
b){var a,e=[],d=c.match(/(@)[\w\d]+[\s]+[\w\d\/.:,]+/g);if(d&&d.length){var f;for(f=0;f<d.length;++f)if(a=d[f].split(" "),a[0]=a[0].replace("@",""),!b||b.contains(a[0]))a[1]=a[1].contains(",")?a[1].split(","):[a[1]],e.push(a)}return e}}},Pipe:{Xhr:function(){var c;this.create=function(a){!0!==a.preventBrowserCaching&&(a.preventBrowserCaching=!1);a.method||(a.method="get");a.callback||(a.callback=function(){});a.preventBrowserCaching&&(a.url+="?_ac="+new Date);c=b();c.open(a.method,a.url,!0);var e=
a.callback;0<a.timeout&&(c.timer=setTimeout(function(){c.abort();e(c,!1)},a.timeout));c.onreadystatechange=function(){4==c.readyState&&(clearTimeout(c.timer),e(c,200==c.status?!0:!1))}};this.open=function(){c.send(null);return this};var b=function(){try{return new XMLHttpRequest}catch(a){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(b){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(c){}return null}}}},require:function(c,b,a){this.instance||(this.instance=new this.Tool.Loader);this.instance.require(c,
b,a);return this.instance},configure:function(c){this.instance.configure(c);return this.instance}};Lazyload.Init()})(this,document);
